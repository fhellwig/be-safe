!function(){function e(e,t,n){e.state("app",{"abstract":!0,views:{"header@":{templateUrl:"app/shared/header.html"},"footer@":{templateUrl:"app/shared/footer.html"}}}),t.otherwise("/"),n.setRelativeBase("/api")}var t=angular.module("app",["ui.router","ui.bootstrap","jsend","app.search","app.email","app.help"]);e.$inject=["$stateProvider","$urlRouterProvider","jsendProvider"],t.config(e)}(),function(){function e(e){e.state("app.email",{"abstract":!0,url:"/email"}).state("app.email.unsubscribe",{url:"/unsubscribe/:uuid",views:{"content@":{templateUrl:"app/email/unsubscribe.html"}}})}var t=angular.module("app.email",[]);e.$inject=["$stateProvider"],t.config(e)}(),function(){function e(e){e.state("app.help",{url:"/help",views:{"content@":{templateUrl:"app/help/user-guide.html"}}})}var t=angular.module("app.help",[]);e.$inject=["$stateProvider"],t.config(e)}(),function(){function e(e){e.state("app.search",{url:"/?type&brand&date&sex&age&skip&limit",views:{"content@":{templateUrl:"app/search/search.html"}}})}var t=angular.module("app.search",[]);e.$inject=["$stateProvider"],t.config(e)}(),function(e){function t(e,t,n,r,a){function i(e){if(e&&e.brand){var t=!1;angular.forEach(l,function(n){n.active=!1,n.term==e.brand&&(n.active=!0,p=n,t=!0)}),c.interval=t?-1:u}}function s(e){p&&(p.active=!1),p=e,p.active=!0;var r=angular.copy(n);r.brand=e.term,r.skip=0,t.go("app.search",r,{reload:!0})}function o(e,t,r){c=e,e.interval=u=1e3*e.seconds,null===l?a.images().then(function(t){l=t,l.length>0&&(l[0].active=!0),i(n),e.images=l}):(e.images=l,i(n)),e.selectImage=s}r.enabled(!0);var u,c,l=null,p=null;return e.$on("$stateChangeSuccess",function(e,t,n){i(n)}),{restrict:"E",scope:{seconds:"="},link:o,templateUrl:"app/carousel/be-safe-carousel.html"}}t.$inject=["$rootScope","$state","$stateParams","$animate","besafe"],e.directive("beSafeCarousel",t)}(angular.module("app.search")),function(e){function t(e,t){var n=this;n.uuid=e.uuid,n.success="",n.error="",t.unsubscribe(n.uuid).then(function(e){n.success=e},function(e){n.error=e})}t.$inject=["$stateParams","besafe"],e.controller("UnsubscribeCtrl",t)}(angular.module("app.email")),function(e){function t(e){var t=new Date(e);return t.toLocaleDateString()}function n(e){var t=[];"number"==typeof e.age?(t.push(11===e.age||8===e.age||18===e.age||e.age>79&&e.age<90?"An":"A"),t.push(e.age),t.push("year-old")):t.push("A");var n="number"==typeof e.age&&e.age<18;return t.push("male"===e.sex?n?"boy":"man":"female"===e.sex?n?"girl":"woman":n?"child":"person"),t.push("experienced"),t.push(r(e.issues)+"."),e.drugs.length>0&&(t.push("This person was taking all of the following:"),t.push(r(e.drugs)+".")),t.join(" ")}function r(e){for(var t=[],n=0,r=e.length;r>n;n++)n>0&&t.push(2===r?" and ":n===r-1?", and ":", "),t.push(e[n]);return t.join("")}e.filter("timestamp",function(){return t}),e.filter("event",function(){return n})}(angular.module("app.search")),function(e){function t(e,t,n){var r=this;r.query=e.query,r.results=e.report,r.email=null,r.complaint=null,r.report=function(){var e={email:r.email,complaint:r.complaint,query:r.query,report:r.results};n({method:"post",url:"/api/reports",data:e}).then(function(e){t.close(),alert("Your adverse reaction has been reported.")},function(e){var n;n=0===e.status?"The Internet connection appears to be offline.":e.statusText,t.close(),alert("There was an error in submitting your report.\n\n"+n)})},r.clear=function(){r.checked===!1&&(r.email=null)},r.cancel=function(){t.dismiss()}}t.$inject=["$scope","$modalInstance","$http"],e.controller("ReportCtrl",t)}(angular.module("app.search")),function(e){function t(e){function t(t,n){var r=parseInt(e[t]);return isNaN(r)?n:r}function n(t,n){var r=e[t];return r=r||n||"",r.trim().toLowerCase()}function r(t,n){var r=e[t],a=i[t][r];return a?r:n}function a(){return{brand:n("brand"),type:r("type","recalls"),age:r("age","any"),date:r("date","any"),sex:r("sex","any"),skip:t("skip",0),limit:t("limit",10)}}var i={date:{any:{days:null,text:"All date ranges"},past30d:{days:30,text:"Past 30 days"},past60d:{days:60,text:"Past 60 days"},past90d:{days:90,text:"Past 90 days"},past12m:{days:365,text:"Past twelve months"},past5y:{days:1825,text:"Past five years"}},type:{recalls:"recalls",events:"events"},sex:{any:{value:null,text:"Both"},male:{value:"m",text:"Male"},female:{value:"f",text:"Female"}},age:{any:{min:0,max:200,text:"All age groups"},infant:{min:0,max:4,text:"Children 0 to 4"},child:{min:5,max:12,text:"Children 5 to 12"},teen:{min:13,max:17,text:"Teens 13 to 17"},young:{min:18,max:25,text:"Adults 18 to 25"},adult:{min:26,max:39,text:"Adults 26 to 39"},mid:{min:40,max:55,text:"Adults 40 to 55"},older:{min:56,max:69,text:"Adults 56 to 69"},elderly:{min:70,max:200,text:"Adults 70+"}}};return{options:i,criteria:a}}t.$inject=["$stateParams"],e.factory("searchParams",t)}(angular.module("app.search")),function(e){function t(e,t,n,r,a){function i(e){var t={search_type:e.type,brand_name:e.brand,skip:e.skip,limit:e.limit};return o.options.date[e.date].days&&(t.offset_days=o.options.date[e.date].days),o.options.sex[e.sex].value&&(t.sex=o.options.sex[e.sex].value),t.min_age=o.options.age[e.age].min,t.max_age=o.options.age[e.age].max,t}function s(e){if(e.brand){var t=i(e);o.waiting=!0,a.search(t).then(function(t){u=t.total,o.request=angular.copy(e),o.results=t.results},function(e){u=0,o.request=null,o.results=null,o.message=e})["finally"](function(){o.waiting=!1})}}var o=this,u=0;o.request=null,o.results=null,o.message=null,o.waiting=!1,o.options=r.options,o.criteria=r.criteria(),o.first=function(){return o.criteria.skip+1},o.last=function(){return Math.min(o.criteria.skip+o.criteria.limit,u)},o.total=function(){return u},o.atBeginning=function(){return 0===o.criteria.skip},o.atEnd=function(){return o.last()>=u},o.prev=function(){o.criteria.skip-=o.criteria.limit,n.go("app.search",o.criteria,{notify:!1}),s(o.criteria)},o.next=function(){o.criteria.skip+=o.criteria.limit,n.go("app.search",o.criteria,{notify:!1}),s(o.criteria)},o.search=function(e){o.criteria.skip=0,e?n.go("app.search",o.criteria):(n.go("app.search",o.criteria,{notify:!1}),s(o.criteria))},o.subscribe=function(){e.query=i(o.criteria),t.open({templateUrl:"app/search/subscribe.html",controller:"SubscriptionCtrl as vm",scope:e})},o.report=function(n){e.report=n,e.query=i(o.criteria),t.open({templateUrl:"app/search/report.html",controller:"ReportCtrl as vm",scope:e})},o.criteria.brand?(s(o.criteria),o.shareLinks={twitter:"https://twitter.com/share?source=tweetbutton&url="+encodeURIComponent(window.location.href),facebook:"https://www.facebook.com/sharer/sharer.php?u="+window.location.origin}):(o.message=null,o.request=null,o.results=null),o.searchTerms=[],a.names().then(function(e){o.searchTerms=e}),o.typeaheadContains=function(e,t){return e.indexOf(t.toLowerCase())>=0},o.typeaheadSelected=function(e){o.criteria.brand=e,o.search()},o.share=function(e){o.shared=e},o.shared=null}t.$inject=["$scope","$modal","$state","searchParams","besafe"],e.controller("SearchCtrl",t)}(angular.module("app.search")),function(e){function t(e,t,n,r){var a=this;a.email=null,a.subscribe=function(){var i=t.href("app.email.unsubscribe",null,{absolute:!0});r("/subscribe").put({email:a.email,query:e.query,unsubscribeLink:i}).then(function(e){n.close(),alert("You will now receive email notifications from BE Safe.")},function(e){n.close(),alert("There was an error requesting the subscription.\n\n"+e.message)})},a.cancel=function(){n.dismiss()}}t.$inject=["$scope","$state","$modalInstance","jsend"],e.controller("SubscriptionCtrl",t)}(angular.module("app.search")),function(e){function t(e,t){function n(){return u.version.get().then(function(e){return e.data})}function r(t){e.defer();return u.drugs.get(t).then(function(e){return e.data},function(t){return t.message?t.message:e.reject("The request failed. Please check your browser log.")})}function a(){return u.images.get().then(function(e){return e.data})}function i(){return u.names.get().then(function(e){return e.data})}function s(t,n,r){return u.subscribe.put({email:vm.email,query:$scope.query,unsubscribeLink:r}).then(function(e){return"You will now receive email notifications from BE Safe."},function(t){return e.reject("There was an error requesting the subscription.\n\n"+t.message)})}function o(t){return u.unsubscribe(t)["delete"]().then(function(e){return"Unsubscribed"},function(t){return e.reject("Error: "+t.code+" ("+t.message+")")})}var u={version:t("/version"),drugs:t("/drugs"),images:t("/carousel"),names:t("/carousel/terms"),subscribe:t("/subscribe"),unsubscribe:function(e){return t("/subscribe/{0}",e)}};return{version:n,search:r,images:a,names:i,subscribe:s,unsubscribe:o}}t.$inject=["$q","jsend"],e.factory("besafe",t)}(angular.module("app")),function(e){function t(e,t,n){var r=this;r.version="unknown",n.version().then(function(e){r.version=e})}t.$inject=["$scope","$state","besafe"],e.controller("HeaderCtrl",t)}(angular.module("app"));